<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - StudyCloud</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='templatemo-glass-admin-style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .task-timer {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .timer-urgent {
            background: rgba(220, 38, 38, 0.15);
            color: var(--danger);
        }
        .timer-soon {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        .timer-ok {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }
        .timer-overdue {
            background: rgba(220, 38, 38, 0.25);
            color: var(--danger);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <div class="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">SC</div>
                <div class="logo-text">StudyCloud</div>
            </div>

            <nav class="nav-menu">
                <ul>
                    <li class="nav-section">
                        <div class="nav-section-title">Main</div>
                        <ul>
                            <li class="nav-item">
                                <a href="{{ url_for('dashboard') }}" class="nav-link active">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                    </svg>
                                    Dashboard
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{{ url_for('dashboard') }}" class="nav-link">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                    </svg>
                                    My Tasks
                                    <span class="nav-badge">{{ tasks|length }}</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{{ url_for('analytics') }}" class="nav-link">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    Analytics
                                </a>
                            </li>
                            {% if current_user.username == 'admin' %}
                            <li class="nav-item">
                                <a href="{{ url_for('admin') }}" class="nav-link">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                    Admin Panel
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </li>

                    <li class="nav-section">
                        <div class="nav-section-title">Filters</div>
                        <ul>
                            <li class="nav-item">
                                <a href="{{ url_for('dashboard', status='all') }}" class="nav-link">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                    </svg>
                                    All Tasks
                                    <span class="nav-badge">{{ all_count }}</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{{ url_for('dashboard', status='complete') }}" class="nav-link">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    Completed
                                    <span class="nav-badge">{{ complete_count }}</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="{{ url_for('dashboard', status='incomplete') }}" class="nav-link">
                                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Pending
                                    <span class="nav-badge">{{ incomplete_count }}</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">{{ current_user.username[0]|upper }}</div>
                    <div class="user-info">
                        <div class="user-name">{{ current_user.username }}</div>
                        <div class="user-role">{{ current_user.email }}</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <nav class="navbar">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="nav-btn mobile-menu-toggle" style="display: none;">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <h1 class="page-title">üìö My Tasks</h1>
                </div>
                
                <div class="navbar-right">
                    <!-- üîî NOTIFICATION BELL -->
                    <div style="position: relative;">
                        <button class="nav-btn" id="notification-bell" onclick="toggleNotifications()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span id="notification-badge" style="display: none; position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; font-weight: 600; align-items: center; justify-content: center;">0</span>
                        </button>
                        
                        <!-- Notification Dropdown -->
                        <div id="notification-dropdown" style="display: none; position: absolute; top: 55px; right: 0; width: 350px; background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 1000; max-height: 400px; overflow-y: auto;">
                            <div style="padding: 15px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">üîî Notifications</h3>
                                <a href="{{ url_for('mark_all_read') }}" style="font-size: 12px; color: var(--purple-light); text-decoration: none;">Mark all read</a>
                            </div>
                            <div id="notification-list" style="padding: 10px;">
                                <p style="text-align: center; color: var(--text-muted); padding: 20px;">Loading...</p>
                            </div>
                            <div style="padding: 10px; border-top: 1px solid var(--glass-border); text-align: center;">
                                <a href="{{ url_for('notifications') }}" style="font-size: 13px; color: var(--purple-light); text-decoration: none; font-weight: 500;">View All Notifications</a>
                            </div>
                        </div>
                    </div>
                    
                    <button class="nav-btn" id="theme-toggle">
                        <svg class="icon-sun" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: block;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg class="icon-moon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                    <a href="{{ url_for('logout') }}" class="nav-btn" title="Logout">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </a>
                </div>
            </nav>

            <!-- üéÆ GAMIFICATION HEADER -->
            <div class="glass-card" style="margin-bottom: 25px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h2 style="font-size: 28px; font-weight: 700; margin: 0 0 8px 0; background: linear-gradient(135deg, #6366f1, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            Welcome back, {{ current_user.username }}! üëã
                        </h2>
                        <p style="color: var(--text-muted); margin: 0; font-size: 14px;">Ready to conquer your tasks today?</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div style="text-align: center; padding: 12px 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px;">
                            <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; letter-spacing: 1px;">LEVEL</div>
                            <div style="font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #fbbf24, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                {{ current_user.level }}
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: 12px 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px;">
                            <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; letter-spacing: 1px;">POINTS</div>
                            <div style="font-size: 22px; font-weight: 700; color: var(--text-primary);">
                                {{ current_user.points }}
                            </div>
                            <div style="font-size: 9px; color: var(--text-muted); margin-top: 3px;">
                                {{ current_user.points_to_next_level() }} to Lvl {{ current_user.level + 1 }}
                            </div>
                        </div>
                        
                        <div style="text-align: center; padding: 12px 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px;">
                            <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; letter-spacing: 1px;">BADGES</div>
                            <div style="font-size: 22px; font-weight: 700; color: var(--text-primary);">
                                üèÜ {{ user_badges|length }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); margin-bottom: 6px;">
                        <span>Level {{ current_user.level }}</span>
                        <span>Level {{ current_user.level + 1 }}</span>
                    </div>
                    <div style="height: 10px; background: var(--glass-bg); border-radius: 10px; overflow: hidden; border: 1px solid var(--glass-border);">
                        <div style="height: 100%; background: linear-gradient(90deg, #6366f1, #a855f7); width: {{ ((current_user.points % 100) / 100 * 100)|int }}%; transition: width 0.5s ease;"></div>
                    </div>
                </div>
            </div>

            <!-- üèÜ BADGES SHOWCASE -->
            {% if user_badges %}
            <div class="glass-card" style="margin-bottom: 25px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 18px; font-weight: 600;">üèÜ Your Badges</h3>
                    <span style="padding: 3px 10px; background: rgba(168, 85, 247, 0.2); border-radius: 20px; font-size: 11px; color: var(--text-primary); font-weight: 600;">
                        {{ user_badges|length }} Earned
                    </span>
                </div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    {% for badge in user_badges %}
                    <div style="padding: 15px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; text-align: center; min-width: 100px;">
                        <div style="font-size: 32px; margin-bottom: 8px;">
                            {% if badge == 'First Step' %}üéØ
                            {% elif badge == 'Task Master' %}‚ö°
                            {% elif badge == 'Productivity Legend' %}üöÄ
                            {% elif badge == 'Century Club' %}üíé
                            {% else %}üèÜ{% endif %}
                        </div>
                        <div style="font-size: 13px; font-weight: 600; color: var(--text-primary);">{{ badge }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                    <div class="glass-card" style="margin-bottom: 20px; padding: 15px; background: {% if category == 'success' %}rgba(34, 197, 94, 0.15){% else %}rgba(220, 38, 38, 0.15){% endif %}; border-color: {% if category == 'success' %}var(--success){% else %}var(--danger){% endif %};">
                        <strong>{{ message }}</strong>
                    </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="stats-grid">
                <div class="glass-card stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Total Tasks</h3>
                            <div class="stat-value">{{ all_count }}</div>
                        </div>
                        <div class="stat-icon cyan">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Completed</h3>
                            <div class="stat-value">{{ complete_count }}</div>
                            <span class="stat-change positive">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Done
                            </span>
                        </div>
                        <div class="stat-icon success">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Pending</h3>
                            <div class="stat-value">{{ incomplete_count }}</div>
                            <span class="stat-change negative">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Todo
                            </span>
                        </div>
                        <div class="stat-icon magenta">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-card-inner">
                        <div class="stat-info">
                            <h3>Completion</h3>
                            <div class="stat-value">{% if all_count > 0 %}{{ ((complete_count / all_count) * 100)|round|int }}%{% else %}0%{% endif %}</div>
                        </div>
                        <div class="stat-icon purple">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-card" style="margin-bottom: 30px;">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">‚ûï Add New Task</h2>
                        <p class="card-subtitle">Create a new task with due date</p>
                    </div>
                </div>
                <form action="{{ url_for('add_task') }}" method="POST">
                    <div style="display: grid; grid-template-columns: 2fr 2fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <input type="text" name="title" placeholder="Task title..." required 
                               style="padding: 12px 16px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-primary); font-family: inherit; font-size: 14px; width: 100%;">
                        <input type="text" name="description" placeholder="Description..." 
                               style="padding: 12px 16px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-primary); font-family: inherit; font-size: 14px; width: 100%;">
                        <select name="priority" 
                                style="padding: 12px 16px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-primary); font-family: inherit; font-size: 14px; width: 100%;">
                            <option value="low">üü¢ Low</option>
                            <option value="medium" selected>üü° Medium</option>
                            <option value="high">üî¥ High</option>
                        </select>
                        <input type="date" name="due_date" 
                               style="padding: 12px 16px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-primary); font-family: inherit; font-size: 14px; width: 100%;">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Task
                    </button>
                </form>
            </div>

            <div class="glass-card table-card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">üìã Your Tasks</h2>
                        <p class="card-subtitle">Manage your study tasks</p>
                    </div>
                    <div class="card-actions">
                        <a href="{{ url_for('dashboard', status='all') }}" class="card-btn {% if filter_status == 'all' %}active{% endif %}">All</a>
                        <a href="{{ url_for('dashboard', status='complete') }}" class="card-btn {% if filter_status == 'complete' %}active{% endif %}">Complete</a>
                        <a href="{{ url_for('dashboard', status='incomplete') }}" class="card-btn {% if filter_status == 'incomplete' %}active{% endif %}">Pending</a>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Task</th>
                                <th>Description</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Due Date</th>
                                <th>Time Left</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if tasks %}
                                {% for task in tasks %}
                                <tr>
                                    <td>{{ task.id }}</td>
                                    <td><strong style="color: var(--text-primary);">{{ task.title }}</strong></td>
                                    <td>{{ task.description or 'No description' }}</td>
                                    <td>
                                        <span class="priority-badge {{ task.priority }}">
                                            {{ task.priority|upper }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="status-badge {{ task.status }}">
                                            {{ task.status|upper }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if task.due_date %}
                                            {{ task.due_date.strftime('%b %d, %Y') }}
                                        {% else %}
                                            <span style="color: var(--text-muted);">No deadline</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if task.due_date and task.status == 'incomplete' %}
                                            <span class="task-timer" data-due-date="{{ task.due_date.isoformat() }}">
                                                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                Calculating...
                                            </span>
                                        {% elif task.status == 'complete' %}
                                            <span class="task-timer timer-ok">‚úÖ Done</span>
                                        {% else %}
                                            <span style="color: var(--text-muted); font-size: 12px;">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <a href="{{ url_for('toggle_task', task_id=task.id) }}" 
                                               style="padding: 6px 12px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 8px; font-size: 12px; transition: all 0.2s;" 
                                               title="Toggle Status">
                                                {% if task.status == 'complete' %}‚ùå{% else %}‚úÖ{% endif %}
                                            </a>
                                            <a href="{{ url_for('delete_task', task_id=task.id) }}" 
                                               style="padding: 6px 12px; background: rgba(220, 38, 38, 0.15); border: 1px solid var(--danger); color: var(--danger); border-radius: 8px; font-size: 12px; transition: all 0.2s;" 
                                               onclick="return confirm('Delete this task?')"
                                               title="Delete">
                                                üóëÔ∏è
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-muted);">
                                        <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto 15px;">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                        </svg>
                                        <br>
                                        No tasks found. Create your first task above!
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='templatemo-glass-admin-script.js') }}"></script>
    <script src="{{ url_for('static', filename='animated-borders.js') }}"></script>
    <script>
        // ‚è∞ COUNTDOWN TIMER FOR TASKS
        function updateTimers() {
            const timers = document.querySelectorAll('.task-timer[data-due-date]');
            const now = new Date();
            
            timers.forEach(timer => {
                const dueDate = new Date(timer.getAttribute('data-due-date'));
                const diff = dueDate - now;
                
                if (diff < 0) {
                    timer.className = 'task-timer timer-overdue';
                    timer.innerHTML = `
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        OVERDUE!
                    `;
                } else {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    
                    let timeText = '';
                    if (days > 0) {
                        timeText = `${days}d ${hours}h`;
                    } else if (hours > 0) {
                        timeText = `${hours}h ${minutes}m`;
                    } else {
                        timeText = `${minutes}m`;
                    }
                    
                    if (diff < 24 * 60 * 60 * 1000) {
                        timer.className = 'task-timer timer-urgent';
                    } else if (diff < 3 * 24 * 60 * 60 * 1000) {
                        timer.className = 'task-timer timer-soon';
                    } else {
                        timer.className = 'task-timer timer-ok';
                    }
                    
                    timer.innerHTML = `
                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        ${timeText}
                    `;
                }
            });
        }
        
        updateTimers();
        setInterval(updateTimers, 60000);

        // üîî NOTIFICATION SYSTEM
        function updateNotificationBadge() {
            fetch('/api/notifications/count')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('notification-badge');
                    if (data.count > 0) {
                        badge.textContent = data.count;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                })
                .catch(error => console.error('Error fetching notification count:', error));
        }

        function loadRecentNotifications() {
            fetch('/api/notifications/recent')
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById('notification-list');
                    if (data.notifications.length === 0) {
                        list.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No notifications</p>';
                    } else {
                        list.innerHTML = data.notifications.map(n => `
                            <div style="padding: 12px; background: ${n.read ? 'transparent' : 'rgba(99, 102, 241, 0.1)'}; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid ${n.read ? 'transparent' : 'var(--purple)'};">
                                <p style="margin: 0; font-size: 14px; color: var(--text-primary);">${n.message}</p>
                                <p style="margin: 5px 0 0 0; font-size: 11px; color: var(--text-muted);">${n.timestamp}</p>
                            </div>
                        `).join('');
                    }
                })
                .catch(error => console.error('Error loading notifications:', error));
        }

        function toggleNotifications() {
            const dropdown = document.getElementById('notification-dropdown');
            if (dropdown.style.display === 'none') {
                dropdown.style.display = 'block';
                loadRecentNotifications();
            } else {
                dropdown.style.display = 'none';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const bell = document.getElementById('notification-bell');
            const dropdown = document.getElementById('notification-dropdown');
            if (bell && dropdown && !bell.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Update badge every 30 seconds
        updateNotificationBadge();
        setInterval(updateNotificationBadge, 30000);
    </script>
</body>
</html>
